@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>123</title>
    <link href="~/EasyUI/themes/icon.css" rel="stylesheet" />
    <link href="~/EasyUI/themes/default/easyui.css" rel="stylesheet" />
    <script type="text/javascript" src="~/Scripts/jquery.min.js"></script>
    <script type="text/javascript" src="~/EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.validate.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.msgProcess.js"></script>
    @*<script type="text/javascript" src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>*@

    <script type="text/javascript">
        $(function () {
            $('#editWindow').window('close');
            $("#tbList").datagrid({
                width: 'auto',
                height: 400,
                striped: true,
                singleSelect: true,
                url: '/admin/sys/GetPermData',
                queryParams: {},
                loadMsg: '数据加载中请稍后……',
                pagination: true,//启用分页。默认每页10行
                rownumbers: true,//显示页码。默认提供10-50的页容量选择
                pageSize: 5,//默认的页容量，此页容量需要在pageList内选择
                pageList: [5, 10],//页容量下拉框选项
                columns: [[
                    { field: 'pid', title: 'ID', width: 100 },
                    { field: 'pName', title: '权限名', width: 100 },
                    { field: 'pAreaName', title: '区域名', width: 100 },
                    { field: 'pControllerName', title: '控制名', width: 100 },
                    { field: 'pActionName', title: 'Action', width: 100 },
                    {
                        field: 'pFormMethod', title: '请求方式', width: 100, align: "center",
                        formatter: function (value) {
                            switch (value.toString()) {
                                case "1":
                                    return "Get";
                                case "2":
                                    return "Post";
                                case "3":
                                    return "Both";
                            }
                        }
                    },
                    {
                        field: 'pOperationType', title: '操作类型', width: 100,
                        formatter: function (value) {
                            switch (value.toString()) {
                                case "0":
                                    return "无操作";
                                case "1":
                                    return "easyui连接";
                                case "2":
                                    return "打开新窗体";
                            }
                        }
                    }
                ]],
                toolbar: [{
                    iconCls: 'icon-edit',
                    text: "编辑",
                    handler: editRow
                }, '-', {
                    iconCls: 'icon-add',
                    text: "新增",
                    handler: addRow
                }, '-', {
                    iconCls: 'icon-remove',
                    text: "删除",
                    handler: removeRow
                }],
                onSelect: function (rowI, rowD) {
                    selectedRowIndex = rowI;//将选中行的下标 设置给全局变量
                }

            });

            initModifyForm();
        })

        //为表单 设置 参数
        function initModifyForm() {
            //$('#modifyForm').form({
            //    url: "/admin/sys/editpermission",
            //    //onSubmit: function () {

            //    //},
            //    success: function (data) {
            //        alert(data)
            //    }
            //});
        }

        //选中行的下标
        var selectedRowIndex = -1;

        //编辑按钮方法
        function editRow() {
            //获取选中行里的数据！
            var rowData = $("#tbList").datagrid("getSelected");
            if (rowData) {
                $('#editWindow').window('open');
                //异步请求 权限修改页面，并直接加载到 当前的 修改窗体中
                //$("#editWindow").load("/admin/sys/editpermission/" + rowData.pid, function (jsonData) {

                //});
                $.get("/admin/sys/editpermission/" + rowData.pid, null, function (jsonObj) {
                    if (jsonObj.Statu)
                        $.procAjaxData(jsonObj);
                    else
                        $("#editWindow").html(jsonObj);
                    
                });
            }

        }

        //新增按钮方法
        function addRow() {
            $('#editWindow').window('open');
            $.get("/admin/sys/addpermission/", null, function (jsonObj) {
                if (jsonObj.Statu)
                    $.procAjaxData(jsonObj);
                else
                    $("#editWindow").html(jsonObj);

            });

        }

        //删除按钮方法
        function removeRow() {
            //获取选中行里的数据！
            var rowData = $("#tbList").datagrid("getSelected");
            if (rowData) {
                $.post("/admin/sys/deletepermission", "id=" + rowData.pid, function (jsonObj) {
                    $.procAjaxData(jsonObj, function () {
                        $("#tbList").datagrid("reload");//删除成功后 刷新页面
                    });
                }, "JSON");
            }

        }
            // submit the form
            //$('#ff').submit();
    </script>
</head>
<body>
    <table id="tbList" style="width:400px;height:250px">
    </table>

    <div id="editWindow" class="easyui-window" title="My Window" style="width:600px;height:400px;"
         data-options="iconCls:'icon-save',modal:true">
        @*<form id="modifyForm" method="post">
        </form>*@
    </div>

</body>
</html>
<!--
            ////获取所有选中行 的数据
            //var $selectedRows = $("#tbList").datagrid("getSelections");

            ////获取选中行的下标
            ////alert(selectedRowIndex);
            ////$("#tbList").datagrid("selectRow", 7);

            ////想获取 选中行的 对象，没想到办法！
-->
